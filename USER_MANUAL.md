# FoodSense Review Workbench - 操作使用手冊

**版本**: 1.0.0  
**更新日期**: 2024-12-16

---

## 📖 目錄

1. [系統概述](#系統概述)
2. [快速開始](#快速開始)
3. [功能導覽](#功能導覽)
4. [詳細操作指南](#詳細操作指南)
5. [整合測試](#整合測試)
6. [故障排除](#故障排除)

---

## 系統概述

FoodSense Review Workbench 是一個用於審核和管理 OCR 掃描記錄的 Web 應用程式。系統提供完整的審核流程管理，包括待審核佇列、審核歷史記錄和黃金樣本管理。

### 主要功能

- ✅ **統計儀表板** - 查看審核系統總覽數據
- ✅ **審核佇列** - 管理待審核的 OCR 記錄
- ✅ **審核提交** - 提交審核結果並建立 Ground Truth
- ✅ **審核歷史** - 查看已完成的審核記錄
- ✅ **黃金樣本** - 管理高品質訓練樣本

### 技術架構

- **前端**: Next.js 15 + TypeScript + Tailwind CSS
- **後端**: FastAPI (Python)
- **認證**: Supabase Auth
- **資料庫**: Supabase (PostgreSQL)

---

## 快速開始

### 前置需求

- Node.js 18+
- 後端 API 正在運行（http://localhost:8000）
- Supabase 帳號和專案

### 安裝步驟

1. **安裝依賴**:
```bash
cd foodsense-frontend
npm install
```

2. **設定環境變數**:
```bash
cp .env.example .env.local
# 編輯 .env.local，填入 Supabase 憑證和 API URL
```

3. **啟動前端**:
```bash
npm run dev
```

4. **訪問應用程式**:
```
http://localhost:3000
```

### 首次登入

1. 開啟瀏覽器，訪問 http://localhost:3000
2. 系統會自動重定向到登入頁面
3. 輸入 Supabase 帳號的 Email 和密碼
4. 登入成功後會自動進入儀表板

---

## 功能導覽

### 1. 統計儀表板 (Dashboard)

**路徑**: `/dashboard`  
**功能**: 顯示審核系統的整體統計資訊

**主要內容**:
- **待審核總數**: 顯示目前待審核的記錄總數
- **FAIL 狀態**: 顯示驗證失敗的記錄數量
- **WARN 狀態**: 顯示驗證警告的記錄數量
- **佇列統計明細表**: 按驗證狀態和信心水平分類的詳細統計

**使用時機**:
- 每日開始工作前查看整體狀態
- 監控審核進度
- 識別需要優先處理的記錄類型

---

### 2. 審核佇列 (Review Queue)

**路徑**: `/review/queue`  
**功能**: 管理待審核的 OCR 記錄

#### 篩選功能

系統提供兩種篩選方式：

1. **驗證狀態 (Validation Status)**:
   - `PASS` - 驗證通過
   - `WARN` - 驗證警告
   - `FAIL` - 驗證失敗

2. **信心水平 (Confidence Level)**:
   - `HIGH` - 高信心度
   - `MEDIUM` - 中等信心度
   - `LOW` - 低信心度

#### 審核記錄列表

每筆記錄顯示以下資訊：
- **記錄 ID**: OCR 記錄的唯一識別碼
- **產品 ID**: 產品識別碼
- **驗證狀態**: PASS/WARN/FAIL
- **信心水平**: HIGH/MEDIUM/LOW
- **建立時間**: 記錄建立的相對時間（例如：2 小時前）

#### 開始審核

1. 在列表中點擊「**開始審核**」按鈕
2. 系統會開啟審核彈窗，顯示記錄詳情
3. 進行審核操作（詳見下方「審核提交」章節）

**使用建議**:
- 優先處理 `FAIL` 狀態的記錄
- 使用篩選功能專注處理特定類型的記錄
- 定期刷新頁面以取得最新資料

---

### 3. 審核提交 (Review Submission)

**功能**: 在審核彈窗中提交審核結果

#### 審核彈窗內容

**記錄資訊區塊**:
- 記錄 ID
- 產品 ID
- 驗證狀態
- 信心水平
- OCR 原始文字（如果有的話）

**審核輸入欄位**:

1. **資料品質分數 (Data Quality Score)**:
   - 範圍: 1-10
   - 滑桿控制
   - 用於評估資料的整體品質

2. **信心分數 (Confidence Score)**:
   - 範圍: 0.0-1.0
   - 滑桿控制，步進 0.01
   - 用於評估審核者對結果的信心

3. **審核備註 (Review Notes)**:
   - 文字輸入框
   - 可選欄位
   - 用於記錄特殊情況或備註

4. **標記為黃金樣本 (Mark as Gold Sample)**:
   - 核取方塊
   - 用於標記高品質訓練樣本

#### 提交流程

1. 檢視記錄資訊和 OCR 原始文字
2. 根據資料品質調整品質分數和信心分數
3. 輸入審核備註（如果需要）
4. 選擇是否標記為黃金樣本
5. 點擊「**提交審核**」按鈕
6. 系統會顯示成功訊息，並自動更新佇列

**注意事項**:
- 提交後記錄會從審核佇列中移除
- 提交的資料會建立為 Ground Truth 記錄
- 標記為黃金樣本的記錄可用於模型訓練

---

### 4. 審核歷史 (Review History)

**路徑**: `/review/history`  
**功能**: 查看已完成的審核記錄

#### 歷史記錄列表

每筆記錄顯示：
- **Ground Truth ID**: 審核結果的唯一識別碼
- **產品 ID**: 產品識別碼
- **品質分數**: 資料品質分數（1-10）
- **信心分數**: 審核信心分數（0.0-1.0）
- **黃金樣本**: 是否為黃金樣本（是/否）
- **建立時間**: 記錄建立的相對時間

#### 使用時機

- 回顧之前的審核工作
- 檢查審核品質
- 查找特定產品的審核記錄

---

### 5. 黃金樣本 (Gold Samples)

**路徑**: `/gold-samples`  
**功能**: 查看和管理高品質訓練樣本

#### 黃金樣本列表

顯示所有標記為黃金樣本的記錄，包含：
- **Ground Truth ID**: 帶有 ⭐ 圖示的識別碼
- **產品 ID**: 產品識別碼
- **品質分數**: 顯示為綠色標籤
- **信心分數**: 顯示為藍色標籤
- **備註**: 審核備註內容
- **建立時間**: 記錄建立的相對時間

#### 黃金樣本的重要性

黃金樣本用於：
- 訓練機器學習模型
- 評估模型效能
- 建立標準化的資料集

**使用建議**:
- 只將高品質、已驗證的記錄標記為黃金樣本
- 定期檢視黃金樣本列表，確保樣本品質
- 使用備註欄位記錄樣本的特別之處

---

## 詳細操作指南

### 完整的審核工作流程

#### 步驟 1: 查看儀表板

1. 登入後進入儀表板
2. 查看待審核總數和狀態分布
3. 決定當日審核優先順序

#### 步驟 2: 進入審核佇列

1. 點擊側邊欄的「審核佇列」
2. 根據需求設定篩選條件
3. 檢視待審核記錄列表

#### 步驟 3: 執行審核

1. 點擊「開始審核」按鈕
2. 仔細檢視記錄資訊和 OCR 原始文字
3. 判斷資料品質和正確性
4. 設定品質分數和信心分數
5. 輸入必要的備註
6. 決定是否標記為黃金樣本
7. 提交審核結果

#### 步驟 4: 確認提交

1. 確認系統顯示成功訊息
2. 記錄會自動從佇列中移除
3. 繼續處理下一筆記錄

#### 步驟 5: 定期檢視歷史

1. 定期查看審核歷史，確認審核品質
2. 檢查黃金樣本列表，評估樣本品質

### 篩選策略建議

#### 優先處理策略

1. **高優先級**: FAIL 狀態 + LOW 信心度
2. **中優先級**: FAIL 狀態 + MEDIUM/HIGH 信心度
3. **低優先級**: WARN/PASS 狀態

#### 效率提升技巧

- 使用篩選功能集中處理同類型記錄
- 批次審核相似類型的產品
- 定期休息，避免疲勞影響審核品質
- 利用審核備註記錄常見問題模式

---

## 整合測試

### 測試腳本使用

系統提供了自動化整合測試腳本，用於驗證前後端整合狀態。

#### 執行測試

```bash
cd foodsense-frontend
./test-integration.sh
```

#### 測試項目

測試腳本會自動檢查：
1. ✅ 後端 API 連線狀態
2. ✅ Review Workbench API 端點可用性
3. ✅ CORS 設定
4. ✅ 前端環境變數配置

#### 測試結果解讀

- **綠色 ✅**: 測試通過
- **黃色 ⚠️**: 測試通過但可能有警告
- **紅色 ❌**: 測試失敗，需要檢查配置

### 手動測試清單

在開發或部署後，建議執行以下手動測試：

#### 認證測試
- [ ] 登入功能正常
- [ ] 登出功能正常
- [ ] Session 維持正常

#### 功能測試
- [ ] 儀表板載入統計資料
- [ ] 審核佇列載入資料
- [ ] 篩選功能運作正常
- [ ] 審核彈窗能正常開啟
- [ ] 提交審核結果成功
- [ ] 審核歷史顯示正確
- [ ] 黃金樣本列表顯示正確

#### UI/UX 測試
- [ ] 響應式設計（手機、平板、桌面）
- [ ] 側邊欄導航正常
- [ ] Toast 通知顯示正確
- [ ] 載入狀態顯示正常
- [ ] 錯誤訊息顯示清楚

---

## 故障排除

### 常見問題與解決方案

#### 1. 無法連線後端 API

**症狀**: 
- 儀表板無法載入資料
- API 錯誤訊息顯示連線失敗

**可能原因**:
- 後端 API 未啟動
- API URL 設定錯誤
- 網路連線問題

**解決方案**:
```bash
# 1. 確認後端正在運行
curl http://localhost:8000/health

# 2. 檢查環境變數
cat .env.local | grep NEXT_PUBLIC_API_URL

# 3. 重啟後端（如果需要）
cd ../foodsense-bacend/backend
uvicorn app.main:app --reload --port 8000
```

#### 2. 登入失敗

**症狀**:
- 輸入帳密後無法登入
- 顯示認證錯誤

**可能原因**:
- Supabase 憑證錯誤
- 使用者不存在
- Email 確認設定問題

**解決方案**:
1. 檢查 `.env.local` 中的 Supabase URL 和 Key
2. 確認在 Supabase Dashboard 中使用者已建立
3. 檢查 Email 確認設定（開發環境建議關閉）

#### 3. API 請求返回 401 Unauthorized

**症狀**:
- API 請求失敗，狀態碼 401
- 顯示未授權錯誤

**可能原因**:
- Supabase session token 過期
- 後端認證模式設定為 required
- JWT secret 未正確設定

**解決方案**:
1. 重新登入以更新 session token
2. 檢查後端 `AUTH_MODE` 設定（開發環境建議設為 `optional`）
3. 如果使用 `AUTH_MODE=required`，確認 `SUPABASE_JWT_SECRET` 已設定

#### 4. CORS 錯誤

**症狀**:
- 瀏覽器控制台顯示 CORS 錯誤
- API 請求被阻止

**可能原因**:
- 後端 CORS 設定未包含前端 URL
- 前端訪問的 URL 不在允許列表中

**解決方案**:
1. 確認後端 `cors_origins` 包含 `http://localhost:3000`
2. 檢查後端配置檔案中的 CORS 設定

#### 5. 資料載入緩慢

**症狀**:
- 頁面載入時間過長
- API 回應延遲

**可能原因**:
- 後端資料庫查詢效能問題
- 網路連線問題
- 資料量過大

**解決方案**:
1. 檢查後端日誌，確認資料庫查詢時間
2. 使用篩選功能減少載入資料量
3. 聯繫後端團隊檢查資料庫效能

#### 6. 提交審核後資料未更新

**症狀**:
- 提交成功但佇列未更新
- 資料仍然顯示

**可能原因**:
- 前端快取問題
- API 請求成功但後端處理失敗

**解決方案**:
1. 重新整理頁面
2. 檢查瀏覽器開發者工具的 Network 標籤，確認 API 回應
3. 查看後端日誌確認是否有錯誤

---

## 鍵盤快捷鍵

目前系統未提供鍵盤快捷鍵，但建議的快捷鍵功能：

- `⌘/Ctrl + K`: 開啟快速搜尋（規劃中）
- `⌘/Ctrl + R`: 重新整理資料（規劃中）
- `Esc`: 關閉彈窗（規劃中）

---

## 系統限制

### 已知限制

1. **分頁**: 目前審核佇列和歷史記錄有分頁限制（預設 50 筆），需要手動刷新或切換頁面以載入更多資料

2. **批次操作**: 目前不支援批次審核，需要逐筆處理

3. **搜尋功能**: 目前不支援全文搜尋，建議使用篩選功能

### 未來規劃

- [ ] 批次審核功能
- [ ] 全文搜尋
- [ ] 鍵盤快捷鍵支援
- [ ] 審核進度追蹤
- [ ] 審核統計報表

---

## 技術支援

### 相關文件

- [快速設定指南](./SETUP.md)
- [README](./README.md)
- [整合測試指南](./INTEGRATION_TEST.md)
- [驗證報告](./VERIFICATION_SUMMARY.md)

### 開發團隊聯繫

如有技術問題或功能建議，請聯繫開發團隊。

---

**最後更新**: 2024-12-16  
**文件版本**: 1.0.0

